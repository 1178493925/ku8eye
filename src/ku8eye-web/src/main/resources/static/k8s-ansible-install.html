<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<!-- /.box-header -->
			<div class="box-body">
				<div style="padding-bottom: 5px;padding-top:15px">
					<h3>正在为您安装kubernetes集群，请耐心等待。。。。</h3>
				</div>
				<table id="example1" class="table table-bordered table-hover" style="font-size: 12px;">
					<thead>
						<tr>
							<th style="width:60%;">
							<div style="padding-bottom: 5px;height:600px;color:#E9C340;background-color:#000000;OVERFLOW-Y: scroll">
								<ul id="installData" style="list-style-type:none;">
									
								</ul>
							</div>
							</th>
							<th><div style="padding-bottom: 5px;height:600px;background-color:#ffffff;OVERFLOW-Y: scroll">
								<ul id="installresult" style="list-style-type:none;">
								
								</ul>
								</div>
							</th>
						</tr>
					</thead>
				</table>
				
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>

<div class="modal fade" id="myModal2" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalLabel">安装成功</h4>
			</div>
			<div class="modal-body">
				<!-- Horizontal Form -->
		          <div class="box box-info" style="margin-bottom:0px;">
		            <!-- form start -->
		            <form class="form-horizontal">
		              <table id="dialogResult" class="table table-bordered table-hover" style="font-size: 12px;text-align:center;">
						<thead>
						<tr>
							<th colspan="2">节点</th>
						
							<th>安装汇总</th>
						</tr>
						</thead>
						</table>
		              <!-- /.box-body -->
		            </form>
		          </div>
		          <!-- /.box -->
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="installFail">关<span style="padding-left: 12px" />闭
				</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" id="installSucc">验证集群
				</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

setTimeout(install, 200);
//每隔2秒，如果数据没更新完成，继续循环
function install(){
	$.ajax({
	    url:"/deploycluster/fetch-ansilbe-result",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	$.each(data.stepResults,function(i,item){
	    		$("#installData").append("<li>"+i+"</li>");
	    		$("#installresult").append("<li>"+i+"</li>");
	    		//左边输出
	    		$.each(item.ansibleRowDatas,function(m,n){
	    			$("#installData").append("<li>"+n+"</li>");
	    		});
	    		//右边输出
				$.each(item.ansibleOutSummary,function(a,b){
					$("#installresult").append("<li>"+b+"</li>");
	    		});
	    	});
	    	
	    	if(data.finished==true){
	    		if(data.success==true){
	    			installResult("success");
	    		}else{
	    			installResult("fail");
	    		}
	    		
	    	}else{
	    		setTimeout(install, 200);
	    	}
	    }
	});
}




function installResult(_type){
	if(_type=="success"){
		$("#myModalLabel").html("安装成功");
		$("#installFail").hide();
		$("#installSucc").show();
	}else{
		$("#myModalLabel").html("安装失败");
		$("#installFail").show();
		$("#installSucc").hide();
	}
	$("#myModal2").modal('show') 
	$.ajax({
	    url:"/deploycluster/ansible-final-result-report/sumary",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	var faileMessage="";
    		$.each(data,function(isa,isb){
				if(data.failedMsgs==null){
	    			
	    		}else{
	    			$.each(data.failedMsgs,function(a,b){
	    				faileMessage+=b+";";
	    			});
	    		}

	    		if(_type=="success"){
	    			$("#dialogResult").append("<tr><td>成功图标</td><td>"+isa+"</td><td>ok="+isb.ok+",changed="+isb.changed+",unreachable="+isb.unreachable+",failed="+isb.failed+",failedMsgs="+faileMessage+"</td></tr>");
	    		}else{
	    			$("#dialogResult").append("<tr><td>失败图标</td><td>"+isa+"</td><td>ok="+isb.ok+",changed="+isb.changed+",unreachable="+isb.unreachable+",failed="+isb.failed+",failedMsgs="+faileMessage+"</td></tr>");
	    		}
	    		
	    	});	
	    }
	});
}


</script>
