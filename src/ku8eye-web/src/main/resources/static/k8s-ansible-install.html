<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<!-- /.box-header -->
			<div class="box-body">
				<div style="padding-bottom: 5px;padding-top:15px">
					<h3>正在为您安装kubernetes集群，请耐心等待。。。。</h3>
				</div>
				<table id="example1" class="table table-bordered table-hover" style="font-size: 12px;">
					<thead>
						<tr>
							<th style="width:60%;">
							<div style="padding-bottom: 5px;height:600px;color:#E9C340;background-color:#000000;OVERFLOW-Y: scroll">
								<ul id="installData" style="list-style-type:none;">
									
								</ul>
							</div>
							</th>
							<th><div style="padding-bottom: 5px;height:600px;background-color:#ffffff;OVERFLOW-Y: scroll">
								<ul id="installresult" style="list-style-type:none;">
								
								</ul>
								</div>
							</th>
						</tr>
					</thead>
				</table>
				
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>

<div class="modal fade" id="myModal2" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalLabel">安装成功</h4>
			</div>
			<div class="modal-body">
				<!-- Horizontal Form -->
		          <div class="box box-info" style="margin-bottom:0px;">
		            <!-- form start -->
		            <form class="form-horizontal">
		              <table id="dialogResult" class="table table-bordered table-hover" style="font-size: 12px;text-align:center;">
						<thead>
						<tr>
							<th colspan="2">节点</th>
						
							<th>安装汇总</th>
						</tr>
						</thead>
						</table>
		              <!-- /.box-body -->
		            </form>
		          </div>
		          <!-- /.box -->
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="installFail">关<span style="padding-left: 12px" />闭
				</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" id="installSucc">验证集群
				</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

setTimeout(install, 200);

function install(){
	$.ajax({
	    url:"/deploycluster/fetch-ansilbe-rawout?mock=true",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	$.each(data,function(i,item){
	    		$("#installData").append("<li>"+item+"</li>");
	    	});
	    }
	});
	
	$.ajax({
	    url:"/deploycluster/fetch-ansilbe-result",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	if(data.success==true){
	    		$.each(data,function(i,item){
	    			//$("#installresult").append("<li>第一级"+i+"</li>");
	    			if(i=="ansibleFinished"||i=="stepName"||i=="success"){
	    				
	    			}else{
	    				$.each(item,function(m,n){
	    					$("#installresult").append("<li>group "+m+"</li>");
	    					$("#installresult").append("<li>Ansible job FAILED</li>");
	    					$.each(n,function(a,b){
	    						$("#installresult").append("<li>&nbsp;&nbsp;&nbsp;&nbsp;task "+a+"</li>");
	    						if(i=="hostTaskResultMap"){
	    							$.each(b,function(c,d){
	    								//$("#installresult").append("<li>第四级c==  "+c+"</li>");
	    								//$("#installresult").append("<li>第四级d==  "+d+"</li>");
	    								if(c=="nodeSumarys"){
	    									$.each(d,function(e,f){
		    									$("#installresult").append("<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node "+e+" result:"+f+"</li>");
		    									//$("#installresult").append("<li>第五级f==  "+f+"</li>");
		    								});
	    								}
	    		    				});
	    						}else{
	    							//$("#installresult").append("<li>第三级b==  "+b+"</li>");
	    						}
		    				});
	    		    	});
	    			}
		    	});
	    		if(data.ansibleFinished==true){
	    			installResult("success");
    			}else{
    				setTimeout(install, 200);
    			}
	    	}else{
	    		$("#installresult").append("<li>"+data.hostTaskResultMap.INIT.INIT.failMsg+"</li>");
	    		installResult("fail");
	    	}

	    }
	});
}




function installResult(_type){
	if(_type=="success"){
		$("#myModalLabel").html("安装成功");
		$("#installFail").hide();
		$("#installSucc").show();
	}else{
		$("#myModalLabel").html("安装失败");
		$("#installFail").show();
		$("#installSucc").hide();
	}
	$("#myModal2").modal('show') 
	$.ajax({
	    url:"/deploycluster/ansible-final-result-report/sumary",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	$.each(data,function(isa,isb){
	    		if(_type=="success"){
	    			$("#dialogResult").append("<tr><td>成功图标</td><td>"+isa+"</td><td>ok="+isb.ok+",changed="+isb.changed+",unreachable="+isb.unreachable+",failed="+isb.failed+"</td></tr>");
	    		}else{
	    			$("#dialogResult").append("<tr><td>失败图标</td><td>"+isa+"</td><td>ok="+isb.ok+",changed="+isb.changed+",unreachable="+isb.unreachable+",failed="+isb.failed+"</td></tr>");
	    		}
	    		
	    	});
	    }
	});
}


</script>
