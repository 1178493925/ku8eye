<style>
	ul li{list-style-type:none;}
	.installationMode{
		width:100%;
		height:100%;
		margin:0 auto;
	}
	.installationMode .projectdocker{
	    margin:20px 15px 20px 15px;
	    height:100%;
		border:1px solid #E8E8E8;
		background-color:#E8F2FC;
	}
	
	.installationMode .projectdocker span{
		width:50%;
		float:left;
		color:#2296C9;
		padding:8px 0px 0px 15px;
	}
	.docker-dialog{
		width:100%;
		height:100%;
	}	
	.docker-dialog tr td{
		padding:8px 4px;
	}
   .projectdocker{
		float:left;
		width:30%;
	}
	.col-text{
		weight:500;
		text-align:right;
		font-size:16px;
		color:#3399FF;
	}
	.col-text1{
		font-size:14px;
		color:#66CCFF;
	}
	.images-control{
		width:80%;
	}	
</style>

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<!-- /.box-header -->
			<div class="box-body">
				<div style="padding-bottom: 5px;margin-left:20px;">	
					
					<input id="dockerName" type="text" style="height:32px;width:29%;margin:0px 5px 0px 40px;padding:2px 2px;" />
					<button id="selectDocker"  class="btn btn-primary" >查询</button>	
					<a class="btn btn-primary " id="addDocker" data-toggle="modal" data-target="#myModal2">添加镜像</a> 
				</div>
				<ul id="example1" class="installationMode">
					
				</ul>
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
	<!-- /.col -->
</div>
<!-- /.row -->

<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalLabel">详细信息</h4>
			</div>
			<div class="modal-body">
				<!-- Horizontal Form -->
		          <div class="box box-info" style="margin-bottom:0px;">
		            <!-- form start -->
		            <form class="form-horizontal">
		              <table style="font-size: 12px;" class="docker-dialog">
						<thead>
						<tr>
							<td class="col-text">名称:</td>
							<td class="col-text1" id="docker-title"></td>
							<td class="col-text">版本:</td>
							<td class="col-text1" id="version"></td>
						</tr>
						<tr>
							<td class="col-text">版本类型:</td>
							<td class="col-text1" id="versionType"></td>
							<td class="col-text">镜像类型:</td>
							<td class="col-text1" id="publicImage"></td>
						</tr>
						<tr>
							<td class="col-text">大小（M）:</td>
							<td class="col-text1" id="size"></td>
							<td class="col-text">状态:</td>
							<td class="col-text1" id="status"></td>
						</tr>
						<tr>
							<td class="col-text">注册表Id:</td>
							<td class="col-text1" id="registryId"></td>
							<td class="col-text">集群Id:</td>
							<td class="col-text1" id="clusterId"></td>
						</tr>	
						
						<tr>
							<td class="col-text">构建文件:</td>
							<td class="col-text1" id="buildFile"></td>
							<td class="col-text">类别:</td>
							<td class="col-text1" id="category"></td>
						</tr>
						<tr>
							<td class="col-text">自动创建:</td>
							<td class="col-text1" id="autoBuild"></td>
							<td class="col-text">更新时间:</td>
							<td class="col-text1" id="lastUpdated"></td>
						</tr>
						<tr>
							<td class="col-text">备注:</td>
							<td class="col-text1" id="note"></td>
						</tr>
						</thead>
						</table>
		              <!-- /.box-body -->
		            </form>
		          </div>
		          <!-- /.box -->
			</div>
			<div class="modal-footer">
				
				<button type="button" class="btn btn-primary" data-dismiss="modal" id="deleDocker">删<span style="padding-left: 12px" />除
				</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">关<span style="padding-left: 12px" />闭
				</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="myModal2" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalLabel">添加镜像</h4>
			</div>
			<div class="modal-body">
				<!-- Horizontal Form -->
		          <div class="box box-info" style="margin-bottom:0px;">
		            <!-- form start -->
		            <form class="form-horizontal">
		              <div class="box-body">
		                <div class="form-group">
		                  <label for="FilePath" class="col-sm-2 control-label">文件路径</label>
		                  <div class="col-sm-10">
		                    <select id="addPathUrl" class="images-control">
		                    	
		                    </select>
		                  </div>
		                </div>
		                
		                <div class="form-group">
		                  <label for="title" class="col-sm-2 control-label">标题</label>
		                  <div class="col-sm-10">
		                    <input type="text" class="images-control" id="addtitle" >
		                  </div>
		                </div>
		                <div class="form-group">
		                  <label for="title" class="col-sm-2 control-label">镜像名称</label>
		                  <div class="col-sm-10">
		                    <input type="text" class="images-control" id="addimageName" >
		                  </div>
		                </div>
		                <div class="form-group">
		                  <label for="version" class="col-sm-2 control-label">版本</label>
		                  <div class="col-sm-10">
		                    <input type="text" class="images-control" id="addversion"  >
		                  </div>
		                </div>
		                <div class="form-group">
		                  <label for="versionType" class="col-sm-2 control-label">版本类型</label>
		                  <div class="col-sm-10">
		                   	<select id="addversionType">
		                   		<option value="0">开发版</option>
		                   		<option value="1">生产版</option>
		                   	</select>
		                  </div>
		                </div>
		                <div class="form-group">
		                  <label for="publicImage" class="col-sm-2 control-label">镜像类型</label>
		                  <div class="col-sm-10">
		                    <select id="addpublicImage">
		                   		<option value="0">私有镜像</option>
		                   		<option value="1">公共镜像</option>
		                   	</select>
		                  </div>
		                </div>
		               
		                <div class="form-group">
		                  <label for="imageIconUrl" class="col-sm-2 control-label">选择图片</label>
		                  <div class="col-sm-10">
		                   <select id="addImageUrl" class="images-control">
		                    	
		                   </select>
		                  </div>
		                </div>
		                <div class="form-group">
		                  <label for="image" class="col-sm-2 control-label"></label>
		                  <div class="col-sm-10" id="showimage">
		                  		
		               
		                  </div>
		                </div>
		                <div class="form-group">
		                  <label for="title" class="col-sm-2 control-label">类别</label>
		                  <div class="col-sm-10">
		                    <input type="text" class="images-control" id="addcategory" >
		                  </div>
		                </div>
		                
		                <div class="form-group">
		                  <label for="title" class="col-sm-2 control-label">文件内容</label>
		                  <div class="col-sm-10">
		                  	<textarea rows="5" cols="50" id="addbuild_file" style="text-align:left;">
		                  	</textarea>
		                  </div>
		                </div>
		                
		                <div class="form-group">
		                  <label for="title" class="col-sm-2 control-label">自动创建</label>
		                  <div class="col-sm-10">
		                  	<textarea rows="5" cols="50" id="addauto_build_command" style="text-align:left;">
		                  	</textarea>
		                  </div>
		                </div>
		                
		                
		                <div class="control-group">
		                	<label for="category" class="col-sm-2 control-label">上传图片</label>
		                  	<div class="col-sm-10">
		                    	<input type="button" id="file_upload" name="fileAttach" type="file"/>
		                  	</div>
                			
            			</div>
		              <!-- /.box-body -->
		            </form>
		          </div>
		          <!-- /.box -->
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关<span style="padding-left: 12px" />闭
				</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal" id="addDockerSave">保<span style="padding-left: 12px" />存
				</button>
			</div>
		</div>
	</div>
</div>
<script>
dockerImage();
$("#selectDocker").click(function(){
	dockerImage();
});

function dockerImage(){
	var ImageName=$("#dockerName").val();	
	$.ajax({
	    url:"/dockerimg/search?key="+ImageName,
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	var count=0;
			var tableList="";
	        $.each(data.data,function(i,item){
	        	if(count==0){
	        		tableList+="<li>";
	        	}
	        	count++;
	        	tableList += [
						'<div class="projectdocker">',
						'<image src="http://localhost:8080/external/logo_pic/'+item.imageIconUrl+'" style="width:100%;height:40px;"/>',
						'<div><span>'+item.title+'</span>',
						item.versionType==1?'<span>生产版</span></div>':'<span>开发版</span></div>',
						'<div>',
						item.publicImage==1?'<span>公共镜像</span>':'<span>私有镜像</span>',
						'<span>镜像大小：'+Math.round((item.size)/1024)+'M</span></div>',
						'<a c="'+item.id+'" style="margin-bottom:10px;font-size:16px;float:right;padding:15px 15px 0px 0px;color:#2296C9;"  data-toggle="modal" data-target="#myModal">查看详情......</a> ',
						'</div>',
	            ].join('');
	        	if(count==3){
	        		tableList+="</li>";
	        		count=0;
	        	}
	        }); 
	        $("#example1").html(tableList);  
	        $( '#example1' ).find('a').bind('click',function(){
	        	var dockerId=$( this ).attr('c');
	        	$.ajax({
	        	    url:"/dockerimg/"+dockerId,
	        	    type: "GET",
	        	    dataType:"json",
	        	    success: function(data){
	        	    	$.each(data,function(a,b){
	        	    		$("#docker-title").html(data.title);
	        	    		if(a!="title"){
	        					$("#"+a).html(b);
	        				}
	        				a=="publicImage"&&b==0?$("#publicImage").html("私有镜像"):$("#publicImage").html("公共镜像");
	        				a=="versionType"&&b==0?$("#versionType").html("开发版"):$("#versionType").html("生产版");
	        				a=="size"?$("#size").html(Math.round(b/1024)+"M"):'';
	        				if(a=="lastUpdated"){
	        					var date = new Date(b);   
	        					var Y = date.getFullYear() + '-';
	        					var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
	        					var D = (date.getDate() < 10 ? '0'+(date.getDate()) : date.getDate()) + ' ';
	        					var h = (date.getHours() < 10 ? '0'+(date.getHours()) : date.getHours()) + ':';
	        					var m = (date.getMinutes() < 10 ? '0'+(date.getMinutes()) : date.getMinutes()) + ':';
	        					var s = (date.getSeconds() < 10 ? '0'+(date.getSeconds()) : date.getSeconds());
	        					$("#lastUpdated").html(Y+M+D+h+m+s)
	        				}
	        	    	});
	        	    }
	        	});
	        	
	        	$("#deleDocker").click(function(){
	        		$.ajax({
		        	    url:"/dockerimg/deletedocker/"+dockerId,
		        	    type: "GET",
		        	    dataType:"text",
		        	    success: function(data){
		        	    	dockerImage();
		        	    }
		        	});
	        	});

	        });
	    },
	    error:function(){
	    	alert("报错！！！！！！");
	    }
	});

}
$("#sumbit").click(function(){
	$('#file_upload').uploadify('upload','*');
	addImageUrl();
});

$('form :input').blur(function(){
    var $parent = $(this).parent();
    $parent.find(".formtips").remove();
    //验证title
    if( $(this).is('#addtitle') ){
           if( this.value==""){
               var errorMsg = '不能为空！';
               $parent.append('<span class="formtips onError" style="color:#FF0000">'+errorMsg+'</span>');
           }
    }
    //验证imageName
    if( $(this).is('#addimageName') ){
       if( this.value==""){
             var errorMsg = '不能为空！';
             $parent.append('<span class="formtips onError" style="color:#FF0000">'+errorMsg+'</span>');
       }
    }
    
  //验证version
    if( $(this).is('#addversion') ){
       if( this.value==""){
             var errorMsg = '不能为空！';
             $parent.append('<span class="formtips onError" style="color:#FF0000">'+errorMsg+'</span>');
       }
    }
  
  //验证category
    if( $(this).is('#addcategory') ){
       if(this.value==""){
             var errorMsg = '不能为空！';
             $parent.append('<span class="formtips onError" style="color:#FF0000">'+errorMsg+'</span>');
       }
    }
  
    
}).keyup(function(){
  $(this).triggerHandler("blur");
}).focus(function(){
    $(this).triggerHandler("blur");
});


$("#addDockerSave").click(function(){
	var _addPathUrl=$("#addPathUrl option:checked").text();
	var _size=$("#addPathUrl option:checked").val();
	var _addtitle=$("#addtitle").val();
	var _addversion=$("#addversion").val();
	var _addversionType=$("#addversionType option:checked").val();
	var _addpublicImage=$("#addpublicImage option:checked").val();
	var _addImageUrl=$("#addImageUrl option:checked").text();
	var _addImageName=$("#addimageName").val();
	var _addcategory=$("#addcategory").val();
	var _addbuild_file=$("#addbuild_file").val();
	var _addauto_build_command=$("#addauto_build_command").val();

	$("form :input.form-control").trigger('blur');
    var numError = $('form .onError').length;
    if(numError){
        return false;
    }else{
    	$.ajax({
    	    url:"/dockerimg/create",
    	    type: "GET",
    	    data:{
    	    	addPathUrl:_addPathUrl,
    	    	addtitle:_addtitle,
    	    	addversion:_addversion,
    	    	addversionType:_addversionType,
    	    	addpublicImage:_addpublicImage,
    	    	addImageUrl:_addImageUrl,
    	    	addImageName:_addImageName,
    	    	size:_size,
    	    	addcategory:_addcategory,
    	    	addbuild_file:_addbuild_file,
    	    	addauto_build_command:_addauto_build_command
    	    },
    	    dataType:"text",
    	    success: function(data){
    	    	if(data=="SUCCESS:"){
    	    		dockerImage();
    	    	}
    	    },
    	    error:function(){
    	    	alert("报错");
    	    }
    	});
    	
    }	
});

function addImageUrl(){
	$.ajax({
	    url:"/extresources/listuploadedimages",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	var pathurl="";
	    	$.each(data,function(i,item){
	    		pathurl+="<option value="+item+">"+i+"</option>"
	    	});
	    	$("#addPathUrl").html(pathurl);
	    },
	    error:function(){
	    	alert("报错");
	    }
	});
	$.ajax({
	    url:"/extresources/listlogosurl",
	    type: "GET",
	    dataType:"json",
	    success: function(data){
	    	var imageurl="";
	    	$.each(data,function(i,item){
	    		var _imageName=item.split("/");
	    		imageurl+="<option>"+_imageName[3]+"</option>";
	    		//imageurl+="<option><image src='../img/success.png'/>werwer</option>";
	    	});
	    	$("#addImageUrl").html(imageurl);
	    	var addImageUrl=$("#addImageUrl option:checked").text();
    		$("#showimage").html("<image src='http://localhost:8080/external/logo_pic/"+addImageUrl+"'/>");
	    	$("#addImageUrl").change(function(){
	    		var addImageUrl=$("#addImageUrl option:checked").text();
	    		$("#showimage").html("<image src='http://localhost:8080/external/logo_pic/"+addImageUrl+"'/>");
	    	});
	    },
	    error:function(){
	    	alert("报错");
	    }
	});
}

addImageUrl();
$(function() {
    $("#file_upload").uploadify({
        height          : 25,
        swf             : '../js/uploadify.swf',
       //后端处理action
        uploader        : '/dockerimg/upload-image',
        width           : 80,
        //fileTypeExts  : '*.doc; *.ppt;*.xls;',
        fileObjName     : 'fileAttach', //文件上传name
        auto            : true, //文件选中后是否自动提交
          multi    : true, //是否多选
       //文件上传完毕后消息框是否自动消失，默认true
        removeCompleted : false,  
        //文件上传完毕后消息框消失延迟时间,默认3 仅removeCompleted=true生效
        //removeTimeout   : 3,
        //文件上传大小限制           
        //fileSizeLimit : 999, 
        //文件队列传输完毕 queueDate [uploadsSuccessful,uploadsErrored]
        onQueueComplete : function(queueData){
           // alert('success:'+queueData.uploadsSuccessful+'fail:'+queueData.uploadsErrored)
        },
         //单文件传输成功           
        onUploadSuccess:function(file, data, response){ 
        	
        },
       //单文件传输失败
        onUploadError : function(file, errorCode, errorMsg, errorString) { 
        	//alert("传输失败");
            //eg:The file mozjs.dll errorCode -200 errorCode -200 errorMsg 302 errorString HTTP Error (302)
            alert('The file ' + file.name + ' errorCode ' + errorCode+ ' errorCode ' + errorCode+ ' errorMsg ' + errorMsg+ ' errorString ' + errorString);
        },
        //按钮显示名称
        buttonText    : "选择图像"                                                         
    });
});

</script>
